var showVis=function(){var t=gon.firstURL,i=function(){d3.selectAll("svg").remove(),d3.json(t,function(t){function i(t,i,s,e){this.width=t,this.height=i,this.fill=s,this.status=0,this.stroke=e}function s(t,i,s,e){this.dishes=[],this.width=t,this.height=i,this.length=s,this.plates=[],this.bowls=[],this.utensils=[],this.equipment=[],this.cookware=[],this.rack=e,this.rackHeightLimit=this.rack.slotHeight}function e(t,i){this.width=t,this.height=i,this.dishes=[],this.freeSpace=this.width,this.usedSpace=0,this.currentPosition=0}function o(t,i){this.baseSlot=t,this.slotCount=i,this.slotHeight=this.baseSlot.height,this.width=this.baseSlot.width,this.slots=[],this.dishes=[],this.plates=[],this.bowls=[];for(var s=0;s<this.slotCount;s++){var o=new e(this.width,this.slotHeight);this.slots.push(o)}this.currentIndex=0}{var h=window.innerWidth,n=(window.innerHeight,h/3),r=n/1.61803398875,l=d3.scale.linear().domain([0,24]).range([0,.95*n]),c=(d3.scale.linear().domain([0,16]).range([.95*r,0]),d3.extent(t,function(t){return t.height})),a=d3.extent(t,function(t){return t.width});d3.scale.linear().domain([0,a[1]]).range(["#000","#fff"]),l(a[1]),l(c[1])}s.prototype.sortDishesByRack=function(){this.dishes.forEach(function(t){t.height<this.rackHeightLimit?this.plates.push(t):t.height>=this.rackHeightLimit&&this.bowls.push(t)},this)},s.prototype.addDish=function(t){this.dishes.push(t)},s.prototype.sortDishesByWidth=function(t){for(var i,s,e=t.length,o=e-2;o>=0;o--){for(i=t[o],s=o;e-1>s&&t[s+1].width>=i.width;)t[s]=t[s+1],++s;t[s]=i}},s.prototype.checkFit=function(t){var i=this.rack.checkFit(t);return i},s.prototype.storeDish=function(t){this.rack.addDish(t)},s.prototype.visualize=function(t){this.visObj=d3.select(t).append("svg").classed("sinkVis",!0).attr({width:n,height:r});var i=l(12),s=l(16),e=d3.select(".sinkVis").append("g").classed("platesContainer",!0).attr({width:i,height:s});e.selectAll(".plateVis").data(this.plates).enter().append("circle").classed(".plateVis",!0).attr({cx:l(6),cy:r-l(6),r:function(t){return l(t.width)/2},fill:function(t){return t.fill},stroke:"#f00"});var o=d3.select(".sinkVis").append("g").classed("bowlsContainer",!0).attr({width:i,height:s});o.selectAll(".bowlVis").data(this.bowls).enter().append("circle").classed(".bowlVis",!0).attr({cx:l(18),cy:r-l(6),r:function(t){return l(t.width)/2},fill:function(t){return t.fill},stroke:"#f00"})},e.prototype.checkFit=function(t){return this.freeSpace>t.width?!0:!1},e.prototype.checkPartial=function(t,i){var s;return this.currentPosition>i?(console.log("this slot CANNOT BE PLACED HERE is currently at "+this.currentPosition+"and this dish should be placed at "+i),s=!1):this.currentPosition+t.width>=this.width?(s=!1,console.log("this slot is currently at "+this.currentPosition+"and this ~"+t.width+"dish should be placed at "+i+" the combined width would be ~ "+(this.currentPosition+t.width)+"and this slot only has this much freeSpace~ "+this.freeSpace)):this.currentPosition+t.width<this.width&&(s=!0,console.log("IT WORKS the combined width would be ~ "+(this.currentPosition+t.width)),console.log("IT WORKS and this slot only has this much freeSpace~ "+this.freeSpace)),s},e.prototype.addDish=function(t){this.dishes.push(t),this.freeSpace=this.width-this.usedSpace,this.usedSpace+=t.width,this.currentPosition+=t.width},e.prototype.addPartial=function(t,i){this.dishes.indexOf(t)<0?(this.currentPosition=i,this.dishes.push(t),this.freeSpace-=t.width,this.usedSpace+=t.width,this.currentPosition+=t.width):this.dishes.indexOf(t)>-1&&console.log("this dish is already here")},o.prototype.checkFit=function(t){var i;if(t.height<this.slotHeight){for(var s=0;s<this.slotCount;s++){var e=(this.currentIndex+s)%this.slotCount;if(i=this.slots[e].checkFit(t),1==i)return i}return i}if(t.height>this.slotHeight)for(var o=Math.ceil(t.width/this.slotHeight),h=this.slotCount-o,s=0;s<this.slotCount;s++){var e=(this.currentIndex+s)%this.slotCount;if(e>h)console.log("skipping slot "+e);else{var n=this.slots[e];console.log("currently testing index ~ "+e);for(var r=n.currentPosition,l=[],c=0;o>c;c++)l.push(this.slots[e+c]);if(i=l.every(function(i){return i.checkPartial(t,r)},this),console.log("results coming"),1==i)return console.log(l),i;1==i||console.log("will not fit at index ~ "+e)}}return i},o.prototype.findFit=function(t){var i;if(t.height<this.slotHeight){for(var s=0;s<this.slotCount;s++){var e=(this.currentIndex+s)%this.slotCount;if(i=this.slots[e].checkFit(t),1==i)return e}return i}if(t.height>this.slotHeight)for(var o=Math.ceil(t.width/this.slotHeight),h=this.slotCount-o,s=0;s<this.slotCount;s++){var e=(this.currentIndex+s)%this.slotCount;if(!(e>h)){for(var n=this.slots[e],r=n.currentPosition,l=[],c=0;o>c;c++)l.push(this.slots[e+c]);if(i=l.every(function(i){return i.checkPartial(t,r)}),1==i)return console.log("the result is ~ "+i+" for these slots ~"+l),console.log("so start with this index ~"+e),console.log(l),e}}return i},o.prototype.addDish=function(t){var i;if(t.height<this.slotHeight){if(i=this.findFit(t),void 0==i)return"no space avaiable for dish";this.currentIndex=i;var s=this.slots[i].currentPosition;t.slotIndex=i,t.slot=this.slots[i],t.slotPosition=s,this.slots[i].addDish(t),this.currentIndex=(this.currentIndex+1)%this.slotCount,this.plates.push(t)}else if(t.height>this.slotHeight){var e=Math.ceil(t.width/this.slotHeight);if(i=this.findFit(t),this.currentIndex=i||this.currentIndex,void 0==i)return"no space avaiable for dish";for(var o=[],s=this.slots[i].currentPosition,h=0;e>h;h++)o.push(this.slots[i+h]);o.forEach(function(i){i.addPartial(t,s)}),t.slotIndex=i+Math.floor(e/2),t.rackPosition=t.slotIndex+this.slotHeight/2,t.slotPosition=s,this.bowls.push(t),console.log("currentIndex = "+this.currentIndex),this.currentIndex=(i+e)%this.slotCount}};var d=d3.scale.linear().domain([0,16]).range([0,.95*r]);o.prototype.visualize=function(t){this.visObj=d3.select(t).append("svg").classed("rackVis",!0).attr({width:n,height:r});var i=d3.select(".rackVis").append("g").classed("rackContainer",!0).attr({width:d(this.width),height:d(this.slotHeight*this.slotCount)});i.selectAll(".rackSlot").data(this.slots).enter().append("rect").classed("rackSlot",!0).attr({x:function(){return d(0)},y:function(t,i){return d(t.height*i)},width:function(t){return d(t.width)},height:function(t){return d(t.height)},fill:"none",stroke:"#000"}),i.selectAll(".rackPlate").data(this.plates).enter().append("rect").classed("rackPlate",!0).attr({x:function(t){return d(t.slotPosition)},y:function(t){return d(t.slotIndex)},width:function(t){return d(t.width)},height:function(t){return d(t.height)},fill:function(t){return t.fill},stroke:"#ee1169"}),i.selectAll(".rackBowl").data(this.bowls).enter().append("circle").classed("rackBowl",!0).attr({cx:function(t){return console.log(t.slotPosition+t.width/2),console.log(t),d(t.slotPosition+t.width/2)},cy:function(t){return console.log(t.rackPosition),d(t.rackPosition)},r:function(t){return d(t.width/2)},fill:function(t){return t.fill},stroke:"#ff00ff"})};var u=new e(22,1),f=new o(u,16),p=new s(22,6,16,f);t.forEach(function(t){var s=new i(t.width,t.height,t.fill,t.stroke);p.addDish(s)}),p.sortDishesByRack(),p.sortDishesByWidth(p.plates),p.sortDishesByWidth(p.bowls),p.plates.forEach(function(t){1==p.checkFit(t)&&p.storeDish(t)},p),p.bowls.forEach(function(t){1==p.checkFit(t)&&p.storeDish(t)},p),p.visualize(".sinkDiv"),f.visualize(".rackDiv")})};i()};$(document).on("page:change",showVis),$(window).resize(showVis);